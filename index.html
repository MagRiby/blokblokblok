<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<!-- PWA / iOS Web App -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Block Puzzle">
<meta name="mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#1565C0">
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icon.svg">
<link rel="icon" type="image/svg+xml" href="icon.svg">

<title>Block Puzzle</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  background: #2979FF;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  font-family: 'Segoe UI', Arial, sans-serif;
  overflow: hidden;
  touch-action: manipulation;
  user-select: none;
  -webkit-touch-callout: none;
  -webkit-tap-highlight-color: transparent;
  -webkit-user-select: none;
}

/* ---- START MENU ---- */
#start-menu {
  position: fixed;
  inset: 0;
  background: linear-gradient(135deg, #1565C0 0%, #2979FF 40%, #42A5F5 100%);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  gap: 30px;
  z-index: 200;
  transition: opacity 0.5s, transform 0.5s;
}
#start-menu.hidden {
  opacity: 0;
  transform: scale(1.1);
  pointer-events: none;
}
#start-menu h1 {
  color: white;
  font-size: 52px;
  text-shadow: 0 4px 20px rgba(0,0,0,0.3);
  letter-spacing: 2px;
}
#start-menu .subtitle {
  color: rgba(255,255,255,0.7);
  font-size: 18px;
  margin-top: -20px;
}
.menu-grid {
  display: grid;
  grid-template-columns: repeat(4, 40px);
  grid-template-rows: repeat(4, 40px);
  gap: 4px;
  margin: 10px 0;
}
.menu-block {
  border-radius: 6px;
  animation: menuFloat 3s ease-in-out infinite;
}
.menu-block:nth-child(odd) { animation-delay: -1.5s; }
.menu-block.red { background: #F44336; box-shadow: inset 0 -3px 0 #C62828; }
.menu-block.green { background: #4CAF50; box-shadow: inset 0 -3px 0 #2E7D32; }
.menu-block.blue { background: #2196F3; box-shadow: inset 0 -3px 0 #1565C0; }
.menu-block.empty { background: rgba(255,255,255,0.08); }
@keyframes menuFloat {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-6px); }
}
#play-btn {
  background: #FFD600;
  color: #1a237e;
  border: none;
  padding: 18px 60px;
  font-size: 24px;
  font-weight: bold;
  border-radius: 40px;
  cursor: pointer;
  box-shadow: 0 6px 25px rgba(0,0,0,0.25);
  transition: transform 0.15s, box-shadow 0.15s;
}
#play-btn:hover { transform: scale(1.05); box-shadow: 0 8px 30px rgba(0,0,0,0.35); }
#play-btn:active { transform: scale(0.97); }
#best-score-display {
  color: rgba(255,255,255,0.6);
  font-size: 16px;
}

/* ---- GAME ---- */
#game-container {
  display: none;
  flex-direction: column;
  align-items: center;
  gap: 16px;
  max-width: 500px;
  width: 100%;
  padding: 12px;
}
#game-container.active { display: flex; }

/* ---- THEME PICKER ---- */
#theme-picker {
  display: flex;
  gap: 12px;
}
.theme-btn {
  background: rgba(255,255,255,0.15);
  color: white;
  border: 2px solid transparent;
  padding: 10px 22px;
  font-size: 16px;
  font-weight: bold;
  border-radius: 25px;
  cursor: pointer;
  transition: all 0.2s;
}
.theme-btn:hover { background: rgba(255,255,255,0.25); }
.theme-btn.active { border-color: #FFD600; background: rgba(255,214,0,0.2); }

/* ---- KAWAII THEME ---- */
body.kawaii {
  background: #FFB6C1;
}
body.kawaii #start-menu {
  background: linear-gradient(135deg, #FFB6C1 0%, #DDA0DD 40%, #E6E6FA 100%);
}
body.kawaii #board {
  background: #F3E5F5;
  border-radius: 16px;
}
body.kawaii .cell {
  border-radius: 10px;
  background: rgba(255,255,255,0.3);
  position: relative;
  overflow: hidden;
}
body.kawaii .cell.pink {
  background: #F48FB1;
  box-shadow: inset 0 -3px 0 #E91E63, inset 0 2px 0 #F8BBD0;
}
body.kawaii .cell.mint {
  background: #80CBC4;
  box-shadow: inset 0 -3px 0 #4DB6AC, inset 0 2px 0 #B2DFDB;
}
body.kawaii .cell.lilac {
  background: #CE93D8;
  box-shadow: inset 0 -3px 0 #AB47BC, inset 0 2px 0 #E1BEE7;
}
body.kawaii .cell.peach {
  background: #FFAB91;
  box-shadow: inset 0 -3px 0 #FF7043, inset 0 2px 0 #FFCCBC;
}
body.kawaii .cell.sky {
  background: #81D4FA;
  box-shadow: inset 0 -3px 0 #4FC3F7, inset 0 2px 0 #B3E5FC;
}
body.kawaii .cell.preview {
  background: rgba(255,255,255,0.45);
}
body.kawaii .cell.clearing {
  animation: kawaiiPop 0.9s ease-out forwards;
}
@keyframes kawaiiPop {
  0% { transform: scale(1) rotate(0); opacity: 1; }
  20% { transform: scale(1.3) rotate(5deg); background: #FFF9C4; box-shadow: 0 0 20px #FFF176; }
  50% { transform: scale(1.1) rotate(-3deg); background: #F8BBD0; }
  100% { transform: scale(0) rotate(15deg); opacity: 0; }
}
body.kawaii .piece-cell { border-radius: 10px; }
body.kawaii .piece-cell.filled.pink { background: #F48FB1; box-shadow: inset 0 -3px 0 #E91E63, inset 0 2px 0 #F8BBD0; }
body.kawaii .piece-cell.filled.mint { background: #80CBC4; box-shadow: inset 0 -3px 0 #4DB6AC, inset 0 2px 0 #B2DFDB; }
body.kawaii .piece-cell.filled.lilac { background: #CE93D8; box-shadow: inset 0 -3px 0 #AB47BC, inset 0 2px 0 #E1BEE7; }
body.kawaii .piece-cell.filled.peach { background: #FFAB91; box-shadow: inset 0 -3px 0 #FF7043, inset 0 2px 0 #FFCCBC; }
body.kawaii .piece-cell.filled.sky { background: #81D4FA; box-shadow: inset 0 -3px 0 #4FC3F7, inset 0 2px 0 #B3E5FC; }
body.kawaii #score-display { color: #E91E63; background: rgba(255,255,255,0.4); }
body.kawaii #moves-display { color: #9C27B0; }
body.kawaii #play-btn { background: #F48FB1; color: white; }
body.kawaii #game-over-overlay { background: rgba(255,182,193,0.85); }
body.kawaii #game-over-overlay h1 { color: #9C27B0; }
body.kawaii #game-over-overlay p { color: #E91E63; }
body.kawaii #restart-btn { background: #F48FB1; color: white; }
body.kawaii .menu-block.pink { background: #F48FB1; box-shadow: inset 0 -3px 0 #E91E63; }
body.kawaii .menu-block.mint { background: #80CBC4; box-shadow: inset 0 -3px 0 #4DB6AC; }
body.kawaii .menu-block.lilac { background: #CE93D8; box-shadow: inset 0 -3px 0 #AB47BC; }
body.kawaii .menu-block.peach { background: #FFAB91; box-shadow: inset 0 -3px 0 #FF7043; }
body.kawaii .menu-block.empty { background: rgba(255,255,255,0.2); }

/* Kawaii faces on cells */
body.kawaii .cell.pink::after,
body.kawaii .cell.mint::after,
body.kawaii .cell.lilac::after,
body.kawaii .cell.peach::after,
body.kawaii .cell.sky::after {
  content: '';
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 60%;
  line-height: 1;
  pointer-events: none;
}
body.kawaii .cell.pink::after { content: '‚óï‚Äø‚óï'; }
body.kawaii .cell.mint::after { content: '‚ó†‚Äø‚ó†'; }
body.kawaii .cell.lilac::after { content: '‚óï·¥ó‚óï'; }
body.kawaii .cell.peach::after { content: '‚óï‚Äø‚óï'; }
body.kawaii .cell.sky::after { content: '‚ó†‚Äø‚ó†'; }
</style>
</head>
<body>

<!-- START MENU -->
<div id="start-menu">
  <h1 id="menu-title">üß© Block Puzzle</h1>
  <p class="subtitle" id="menu-subtitle">Fill lines. Score big.</p>
  <div class="menu-grid" id="menu-grid"></div>
  <div id="theme-picker">
    <button class="theme-btn active" data-theme="classic">üéÆ Classic</button>
    <button class="theme-btn" data-theme="kawaii">üå∏ Kawaii</button>
  </div>
  <button id="play-btn">‚ñ∂ PLAY</button>
  <div id="best-score-display"></div>
</div>

<!-- GAME -->
<div id="game-container">
  <div id="top-bar">
    <div id="score-display"><span class="trophy">üèÜ</span><span id="score">0</span></div>
    <div id="moves-display">0</div>
  </div>
  <div id="board"></div>
  <div id="pieces-tray"></div>
</div>

<!-- OVERLAYS -->
<div id="game-over-overlay">
  <h1>Game Over</h1>
  <p>Score: <span id="final-score">0</span></p>
  <button id="restart-btn">Play Again</button>
</div>

<!-- PARTICLES CANVAS -->
<canvas id="particles" style="position:fixed;inset:0;pointer-events:none;z-index:150;"></canvas>

<!-- LINE CLEAR BANNER -->
<div id="clear-banner"></div>
<div id="screen-flash"></div>

<script src="game.js"></script>
<script>
// Register service worker for offline / PWA
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('./sw.js');
}

// Prevent double-tap zoom on iOS
let lastTap = 0;
document.addEventListener('touchend', e => {
  const now = Date.now();
  if (now - lastTap < 300) e.preventDefault();
  lastTap = now;
}, { passive: false });

// Prevent pinch zoom
document.addEventListener('gesturestart', e => e.preventDefault());
document.addEventListener('gesturechange', e => e.preventDefault());
</script>
</body>
</html>
<!-- Additional styles that didn't fit above -->
<style>
#top-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  width: 100%;
  padding: 0 4px;
}
#score-display {
  display: flex;
  align-items: center;
  gap: 8px;
  background: rgba(0,0,0,0.15);
  padding: 6px 16px;
  border-radius: 20px;
  color: #FFD600;
  font-size: 24px;
  font-weight: bold;
}
#moves-display {
  color: white;
  font-size: 40px;
  font-weight: bold;
}
#board {
  display: grid;
  grid-template-columns: repeat(8, 1fr);
  grid-template-rows: repeat(8, 1fr);
  gap: 2px;
  width: 100%;
  aspect-ratio: 1;
  background: #1a237e;
  border-radius: 8px;
  padding: 4px;
  position: relative;
}
.cell {
  border-radius: 4px;
  background: rgba(255,255,255,0.06);
  aspect-ratio: 1;
  transition: background 0.1s, transform 0.1s;
}
.cell.red { background: #F44336; box-shadow: inset 0 -3px 0 #C62828, inset 0 2px 0 #EF5350; }
.cell.green { background: #4CAF50; box-shadow: inset 0 -3px 0 #2E7D32, inset 0 2px 0 #66BB6A; }
.cell.blue { background: #2196F3; box-shadow: inset 0 -3px 0 #1565C0, inset 0 2px 0 #42A5F5; }
.cell.preview { background: rgba(255,255,255,0.22); }
.cell.clearing {
  animation: clearPop 0.9s ease-out forwards;
}
.cell.flash-white {
  animation: flashWhite 0.7s ease-out;
}
@keyframes clearPop {
  0% { transform: scale(1); opacity: 1; }
  15% { transform: scale(1.3); opacity: 1; background: white; box-shadow: 0 0 20px white; }
  35% { transform: scale(1.1); opacity: 1; background: #FFD600; box-shadow: 0 0 25px #FFD600; }
  60% { transform: scale(1.05); opacity: 0.8; background: #FF9100; box-shadow: 0 0 15px #FF9100; }
  100% { transform: scale(0); opacity: 0; }
}
@keyframes flashWhite {
  0% { background: white; box-shadow: 0 0 25px white; }
  50% { background: rgba(255,214,0,0.4); box-shadow: 0 0 10px #FFD600; }
  100% { background: rgba(255,255,255,0.06); box-shadow: none; }
}
#pieces-tray {
  display: flex;
  justify-content: center;
  gap: 16px;
  width: 100%;
  min-height: 130px;
  align-items: center;
  padding: 8px;
}
.piece-container {
  cursor: grab;
  display: grid;
  gap: 2px;
  padding: 6px;
  border-radius: 6px;
  transition: transform 0.15s, opacity 0.15s;
}
.piece-container:active { cursor: grabbing; }
.piece-container.dragging { opacity: 0.5; transform: scale(0.9); }
.piece-cell { width: 32px; height: 32px; border-radius: 5px; }
.piece-cell.filled.red { background: #F44336; box-shadow: inset 0 -3px 0 #C62828, inset 0 2px 0 #EF5350; }
.piece-cell.filled.green { background: #4CAF50; box-shadow: inset 0 -3px 0 #2E7D32, inset 0 2px 0 #66BB6A; }
.piece-cell.filled.blue { background: #2196F3; box-shadow: inset 0 -3px 0 #1565C0, inset 0 2px 0 #42A5F5; }
.piece-cell.empty { background: transparent; width: 32px; height: 32px; }

/* Game Over */
#game-over-overlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.75);
  justify-content: center;
  align-items: center;
  flex-direction: column;
  gap: 20px;
  z-index: 100;
}
#game-over-overlay.show { display: flex; }
#game-over-overlay h1 { color: white; font-size: 42px; }
#game-over-overlay p { color: #FFD600; font-size: 26px; }
#restart-btn {
  background: #FFD600;
  color: #1a237e;
  border: none;
  padding: 14px 40px;
  font-size: 20px;
  font-weight: bold;
  border-radius: 30px;
  cursor: pointer;
}
#restart-btn:hover { background: #FFEA00; }

/* Clear banner */
#clear-banner {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(0);
  color: white;
  font-size: 56px;
  font-weight: bold;
  text-shadow: 0 0 30px rgba(255,214,0,0.8), 0 4px 20px rgba(0,0,0,0.5);
  z-index: 160;
  pointer-events: none;
  opacity: 0;
  transition: none;
  white-space: nowrap;
}

/* Full screen flash */
#screen-flash {
  position: fixed;
  inset: 0;
  background: white;
  opacity: 0;
  pointer-events: none;
  z-index: 140;
  transition: none;
}
#screen-flash.flash {
  animation: screenFlash 0.8s ease-out forwards;
}
@keyframes screenFlash {
  0% { opacity: 0.5; }
  100% { opacity: 0; }
}
#clear-banner.show {
  animation: bannerPop 1.8s ease-out forwards;
}
@keyframes bannerPop {
  0% { transform: translate(-50%, -50%) scale(0) rotate(-5deg); opacity: 0; }
  10% { transform: translate(-50%, -50%) scale(1.4) rotate(2deg); opacity: 1; }
  20% { transform: translate(-50%, -50%) scale(1) rotate(0deg); opacity: 1; }
  70% { transform: translate(-50%, -50%) scale(1) rotate(0deg); opacity: 1; }
  100% { transform: translate(-50%, -50%) scale(1.8) rotate(3deg); opacity: 0; }
}

/* Screen shake */
.screen-shake {
  animation: shake 0.5s ease-out;
}
@keyframes shake {
  0%, 100% { transform: translate(0); }
  15% { transform: translate(-6px, 3px); }
  30% { transform: translate(6px, -4px); }
  45% { transform: translate(-5px, 5px); }
  60% { transform: translate(5px, -2px); }
  75% { transform: translate(-3px, 3px); }
  90% { transform: translate(2px, -1px); }
}
</style>
